<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Culinary Canvas</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Merriweather:wght@700&display=swap"
        rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }

        :root {
            --bg: #f7f9fb;
            --card: #ffffff;
            --muted: #6b7280;
            --text: #17202a;
            --primary: #264653;
            /* deep teal */
            --accent: #2a9d8f;
            /* muted teal */
            --border: #e6eef0;
            --shadow: 0 6px 18px rgba(23, 32, 42, 0.06);
        }

        html,
        body {
            height: 100%;
            margin: 0;
            background: var(--bg);
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            color: var(--text);
        }

        header {
            position: sticky;
            top: 0;
            background: transparent;
            padding: 1.25rem 1rem;
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(6px);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem
        }

        .logo {
            font-family: 'Merriweather', serif;
            font-size: 1.25rem;
            color: var(--primary);
            font-weight: 700;
            letter-spacing: 0.2px
        }

        .search-bar {
            display: flex;
            gap: .5rem;
            flex: 1;
            max-width: 520px;
            margin-left: 2rem
        }

        .search-bar input {
            flex: 1;
            padding: .65rem 1rem;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: transparent;
            font-size: 0.95rem;
            color: var(--text)
        }

        .search-bar button {
            padding: .65rem 1rem;
            border-radius: 10px;
            border: 1px solid var(--primary);
            background: transparent;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem
        }

        .hero {
            background: linear-gradient(180deg, rgba(42, 157, 143, 0.06), rgba(38, 70, 83, 0.02));
            padding: 1.6rem;
            border-radius: 14px;
            border: 1px solid var(--border);
            text-align: left;
            margin-bottom: 1.75rem
        }

        .hero h1 {
            font-family: 'Merriweather', serif;
            font-size: 1.6rem;
            margin: 0;
            color: var(--primary)
        }

        .hero p {
            margin-top: .5rem;
            color: var(--muted);
            font-size: 0.98rem
        }

        .filter-buttons {
            display: flex;
            gap: .6rem;
            flex-wrap: wrap;
            margin: 1.25rem 0 1.75rem
        }

        .filter-btn {
            background: transparent;
            border: 1px solid var(--border);
            padding: .5rem .9rem;
            border-radius: 999px;
            color: var(--muted);
            cursor: pointer;
            font-weight: 600
        }

        .filter-btn.active {
            border-color: var(--primary);
            color: var(--primary);
            background: linear-gradient(90deg, rgba(38, 70, 83, 0.03), transparent)
        }

        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.25rem
        }

        .recipe-card {
            background: var(--card);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            transition: transform .18s ease, box-shadow .18s ease
        }

        .recipe-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 18px 40px rgba(23, 32, 42, 0.08)
        }

        .recipe-image {
            height: 180px;
            background: linear-gradient(135deg, rgba(38, 157, 143, 0.12), rgba(38, 70, 83, 0.06));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative
        }

        .recipe-initials {
            width: 72px;
            height: 72px;
            border-radius: 12px;
            background: linear-gradient(180deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.05rem;
            font-family: 'Merriweather', serif
        }

        .recipe-category {
            position: absolute;
            left: 1rem;
            top: 1rem;
            background: rgba(23, 32, 42, 0.06);
            border-radius: 999px;
            padding: .35rem .6rem;
            font-size: .78rem;
            color: var(--muted);
            border: 1px solid var(--border)
        }

        .recipe-content {
            padding: 1.15rem 1rem 1.25rem;
            display: flex;
            flex-direction: column;
            flex: 1
        }

        .recipe-title {
            font-weight: 600;
            margin: 0 0 .4rem;
            font-size: 1.05rem;
            color: var(--text)
        }

        .recipe-description {
            color: var(--muted);
            font-size: .92rem;
            margin-bottom: .9rem;
            flex: 1
        }

        .recipe-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: .75rem
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: .45rem;
            color: var(--muted);
            font-size: .9rem
        }

        .view-recipe {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: .45rem .8rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(10, 12, 15, 0.45);
            align-items: center;
            justify-content: center;
            padding: 1.25rem;
            z-index: 999
        }

        .modal.active {
            display: flex
        }

        .modal-content {
            background: var(--card);
            border-radius: 12px;
            max-width: 720px;
            width: 100%;
            padding: 1.25rem 1.5rem;
            max-height: 86vh;
            overflow: auto;
            border: 1px solid var(--border)
        }

        .modal h2 {
            margin: 0 0 .75rem;
            font-family: 'Merriweather', serif;
            color: var(--primary)
        }

        .close-modal {
            position: absolute;
            right: 1rem;
            top: 1rem;
            background: transparent;
            border: none;
            font-size: 1.25rem;
            color: var(--muted);
            cursor: pointer
        }

        .modal-section {
            margin-bottom: .9rem
        }

        .modal-section h3 {
            margin: 0 0 .45rem;
            font-size: .98rem;
            color: var(--text)
        }

        .modal-section ul {
            margin: 0;
            padding-left: 1.05rem
        }

        .modal-section li {
            margin: .35rem 0;
            color: var(--muted)
        }

        footer {
            max-width: 1200px;
            margin: 2.25rem auto;
            padding: 1rem;
            color: var(--muted);
            text-align: center;
            font-size: .95rem
        }

        @media (max-width:768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start
            }

            .search-bar {
                margin-left: 0;
                width: 100%
            }

            .recipes-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr))
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <div class="header-content">
            <div class="logo">Culinary Canvas</div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search recipes by name or description">
                <button type="button" onclick="searchRecipes()">Search</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="hero">
            <h1>Thoughtfully curated recipes</h1>
            <p>Discover extraordinary recipes that transform simple ingredients into memorable experiences</p>
        </div>

        <div class="filter-buttons">
            <button class="filter-btn active" type="button" onclick="filterRecipes('all', this)">All Recipes</button>
            <button class="filter-btn" type="button" onclick="filterRecipes('breakfast', this)">Breakfast</button>
            <button class="filter-btn" type="button" onclick="filterRecipes('lunch', this)">Lunch</button>
            <button class="filter-btn" type="button" onclick="filterRecipes('dinner', this)">Dinner</button>
            <button class="filter-btn" type="button" onclick="filterRecipes('dessert', this)">Dessert</button>
        </div>

        <div class="recipes-grid" id="recipesGrid"></div>
    </div>

    <!-- Modal -->
    <div class="modal" id="recipeModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Culinary Canvas ‚Äî Crafted for food lovers.</p>
    </footer>

    <script>
        const recipes = [
            {
                id: 1,
                title: "Creamy Pasta Carbonara",
                description: "Classic Italian pasta with eggs, cheese, and bacon",
                category: "lunch",
                time: "20 min",
                servings: "4",
                difficulty: "Easy",
                ingredients: ["400g spaghetti", "200g pancetta or bacon", "4 large eggs", "100g Pecorino Romano cheese", "Black pepper", "Salt"],
                instructions: ["Cook pasta in salted boiling water until al dente", "Fry pancetta until crispy, then set aside", "Whisk eggs with grated cheese and black pepper", "Toss hot pasta with pancetta and egg mixture", "Serve immediately with extra cheese"]
            },
            {
                id: 2,
                title: "Fluffy Pancakes",
                description: "Perfect breakfast pancakes with a light and airy texture",
                category: "breakfast",
                time: "25 min",
                servings: "4",
                difficulty: "Easy",
                ingredients: [
                    "2 cups all-purpose flour",
                    "2 tablespoons sugar",
                    "2 teaspoons baking powder",
                    "1/2 teaspoon salt",
                    "2 eggs",
                    "1 3/4 cups milk",
                    "4 tablespoons melted butter"
                ],
                instructions: [
                    "Mix dry ingredients in a bowl",
                    "Whisk wet ingredients separately",
                    "Combine wet and dry ingredients until just mixed",
                    "Cook on buttered griddle until bubbles form",
                    "Flip and cook until golden brown"
                ]
            },
            {
                id: 3,
                title: "Grilled Salmon with Lemon",
                description: "Fresh salmon fillet grilled with herbs and citrus",
                category: "dinner",
                time: "30 min",
                servings: "2",
                difficulty: "Medium",
                ingredients: [
                    "2 salmon fillets (6 oz each)",
                    "2 lemons",
                    "Fresh dill",
                    "Olive oil",
                    "Garlic cloves",
                    "Salt and pepper"
                ],
                instructions: [
                    "Preheat grill to medium-high heat",
                    "Season salmon with salt, pepper, and garlic",
                    "Place on oiled grill grates",
                    "Grill for 4-5 minutes per side",
                    "Garnish with fresh dill and lemon slices"
                ]
            },
            {
                id: 4,
                title: "Chocolate Lava Cake",
                description: "Decadent warm chocolate cake with flowing center",
                category: "dessert",
                time: "15 min",
                servings: "2",
                difficulty: "Medium",
                ingredients: [
                    "100g dark chocolate",
                    "50g butter",
                    "2 eggs",
                    "2 egg yolks",
                    "25g sugar",
                    "15g flour",
                    "Pinch of salt"
                ],
                instructions: [
                    "Preheat oven to 200¬∞C",
                    "Melt chocolate and butter together",
                    "Beat eggs, yolks, and sugar until thick",
                    "Fold in chocolate mixture and flour",
                    "Divide into ramekins and bake 12-14 minutes"
                ]
            },
            {
                id: 5,
                title: "Veggie Stir Fry",
                description: "Colorful mix of fresh vegetables in a savory sauce",
                category: "lunch",
                time: "20 min",
                servings: "3",
                difficulty: "Easy",
                ingredients: [
                    "2 cups mixed vegetables",
                    "3 tablespoons soy sauce",
                    "2 cloves garlic",
                    "1 tablespoon sesame oil",
                    "1 teaspoon ginger",
                    "2 tablespoons vegetable oil"
                ],
                instructions: [
                    "Heat oil in a wok or large pan",
                    "Add garlic and ginger, stir-fry 30 seconds",
                    "Add vegetables and stir-fry for 5-7 minutes",
                    "Add soy sauce and sesame oil",
                    "Serve hot over rice"
                ]
            },
            {
                id: 6,
                title: "Greek Salad",
                description: "Fresh and healthy salad with feta cheese and olives",
                category: "lunch",
                time: "10 min",
                servings: "2",
                difficulty: "Easy",
                ingredients: [
                    "2 tomatoes",
                    "1 cucumber",
                    "1/2 red onion",
                    "100g feta cheese",
                    "100g Kalamata olives",
                    "Olive oil and lemon juice"
                ],
                instructions: [
                    "Dice tomatoes and cucumber",
                    "Slice onion thinly",
                    "Combine vegetables in a bowl",
                    "Add olives and crumbled feta",
                    "Dress with olive oil and lemon juice"
                ]
            },
            {
                id: 7,
                title: "Eggs Benedict",
                description: "Poached eggs and hollandaise on toasted English muffin",
                category: "breakfast",
                time: "30 min",
                servings: "2",
                difficulty: "Medium",
                ingredients: [
                    "4 eggs",
                    "2 English muffins",
                    "100g butter",
                    "2 egg yolks",
                    "1 tablespoon lemon juice",
                    "Cayenne pepper"
                ],
                instructions: [
                    "Make hollandaise by whisking yolks over gentle heat",
                    "Gradually add melted butter while whisking",
                    "Add lemon juice and season",
                    "Poach eggs in simmering water",
                    "Top toasted muffins with eggs and sauce"
                ]
            },
            {
                id: 8,
                title: "Beef Tacos",
                description: "Seasoned ground beef with fresh toppings",
                category: "dinner",
                time: "25 min",
                servings: "4",
                difficulty: "Easy",
                ingredients: ["500g ground beef", "8 taco shells", "1 onion", "2 tomatoes", "1 cup lettuce", "Taco seasoning", "Cheddar cheese"],
                instructions: ["Brown ground beef in a pan", "Add taco seasoning and water", "Simmer for 10 minutes", "Warm taco shells", "Assemble with beef, lettuce, tomato, and cheese"]
            },
            {
                id: 9,
                title: "Palak Tofu",
                description: "Spinach and tofu curry with aromatic spices and cashews",
                category: "dinner",
                time: "60 min",
                servings: "5",
                difficulty: "Medium",
                ingredients: [
                    "Cooking oil and/or Ghee (as needed)",
                    "1/3 tsp Cumin Seeds",
                    "5 Green Cardamom Pods",
                    "2 1/2-inch piece Cinnamon Stick",
                    "5 Cloves",
                    "3-4 Green Chilies (adjust to taste)",
                    "1.5 cup (225g) Onions, chopped",
                    "2 tsp Ginger-Garlic Paste",
                    "1.25 cup Tomatoes, chopped",
                    "1.25 tsp Salt (or to taste)",
                    "1.5 tsp Garam Masala",
                    "1 cup Water (for cooking gravy)",
                    "300g Baby Spinach, triple-washed",
                    "25 Roasted Cashews",
                    "0.75 cup Water (for blending spinach)",
                    "1 block (~400g) Firm Tofu, pressed and cubed",
                    "1.5 tsp Kasuri Methi (dried fenugreek leaves), crushed"
                ],
                instructions: [
                    "Heat oil/ghee. Add whole spices and sizzle, then add green chilies and onions; fry thoroughly. Stir in ginger-garlic paste.",
                    "Add tomatoes, salt, and garam masala; cook until softened.",
                    "Pour in 1 cup of water. Cover and cook until about 20% of the water remains.",
                    "Cool completely, then blend the mixture into a smooth puree. Set aside.",
                    "In a separate pan, cook the spinach until wilted and the raw scent is gone. Let it cool.",
                    "In a blender, combine the cooled spinach, roasted cashews, and 3/4 cup water. Puree until smooth.",
                    "Optional: Lightly saut√© the tofu cubes in a separate pan for a firmer texture.",
                    "Reheat the blended onion-tomato gravy. Stir in the crushed kasuri methi.",
                    "Pour in the spinach puree and stir to combine.",
                    "Add the tofu cubes and gently mix.",
                    "Cover and let the curry sit for 3-4 hours to allow the tofu to absorb the flavors.",
                    "Reheat and enjoy with rice or roti."
                ]
            }
        ];

        let filteredRecipes = [...recipes];
        let currentCategory = 'all';
        // units preference: 'metric' or 'imperial'
        let unitsPref = localStorage.getItem('units_pref') || 'metric';

        function getInitials(title) {
            return title.split(' ').slice(0, 2).map(w => w[0] ? w[0].toUpperCase() : '').join('');
        }

        function renderRecipes(recipesToRender) {
            const grid = document.getElementById('recipesGrid');
            grid.innerHTML = recipesToRender.map(recipe => {
                const initials = getInitials(recipe.title);
                return `
                <div class="recipe-card" onclick="openModal(${recipe.id})" role="button" tabindex="0">
                    <div class="recipe-image">
                        <div class="recipe-initials">${initials}</div>
                        <div class="recipe-category">${recipe.category}</div>
                    </div>
                    <div class="recipe-content">
                        <h3 class="recipe-title">${recipe.title}</h3>
                        <p class="recipe-description">${recipe.description}</p>
                        <div class="recipe-meta">
                            <div style="display:flex;gap:.6rem;align-items:center">
                                <div class="meta-item">‚è± ${recipe.time}</div>
                                <div class="meta-item">üë• ${recipe.servings}</div>
                            </div>
                            <button class="view-recipe" type="button">View Recipe</button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        function filterRecipes(category, btn) {
            currentCategory = category;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            filteredRecipes = category === 'all' ? [...recipes] : recipes.filter(r => r.category === category);
            renderRecipes(filteredRecipes);
        }

        function searchRecipes() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            // clear filter active state
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            filteredRecipes = recipes.filter(r => r.title.toLowerCase().includes(searchTerm) || r.description.toLowerCase().includes(searchTerm));
            renderRecipes(filteredRecipes);
        }

        // --- Ingredient scaling helpers ---
        function parseMixedNumber(token) {
            // handles "1 1/2" or "3/4"
            token = token.trim();
            const mixed = token.match(/^(\d+)\s+(\d+)\/(\d+)$/);
            if (mixed) {
                return parseInt(mixed[1], 10) + (parseInt(mixed[2], 10) / parseInt(mixed[3], 10));
            }
            const frac = token.match(/^(\d+)\/(\d+)$/);
            if (frac) {
                return parseInt(frac[1], 10) / parseInt(frac[2], 10);
            }
            const num = parseFloat(token);
            return isNaN(num) ? null : num;
        }

        function formatNumber(n) {
            if (n == null) return '';
            // integer
            if (Math.abs(n - Math.round(n)) < 1e-6) return String(Math.round(n));
            // handle mixed numbers > 1
            const whole = Math.floor(Math.abs(n));
            const fracPart = Math.abs(n) - whole;
            // candidate denominators we support
            const dens = [2, 3, 4, 6, 8];
            let best = { err: Infinity, num: 0, den: 1 };
            for (const d of dens) {
                const num = Math.round(fracPart * d);
                const err = Math.abs(fracPart - (num / d));
                if (err < best.err) { best = { err, num, den: d }; }
            }
            if (best.err < 0.03 && best.num !== 0) {
                const sign = n < 0 ? '-' : '';
                if (whole === 0) return `${sign}${best.num}/${best.den}`;
                return `${sign}${whole} ${best.num}/${best.den}`;
            }
            return (Math.round(n * 100) / 100).toString();
        }

        // Unit conversion helper: convert value and unit to target system
        function convertUnit(value, unit, targetSystem) {
            if (!unit) return { value, unit };
            const u = unit.toLowerCase();
            // normalize to base: grams for weight, ml for volume
            const weightUnits = { g: 1, gram: 1, grams: 1, kg: 1000, kilogram: 1000, kilograms: 1000, oz: 0.0, ounce: 0.0, lb: 0.0, pound: 0.0 };
            const volumeUnits = { ml: 1, milliliter: 1, l: 1000, liter: 1000, litre: 1000, tsp: 4.92892, teaspoon: 4.92892, tbsp: 14.7868, tablespoon: 14.7868, cup: 240 };

            // detect weight units
            if (/^(g|gram|grams|kg|kilogram|kilograms|oz|ounce|ounces|lb|lbs|pound|pounds)$/i.test(u)) {
                // convert any to grams
                let grams = null;
                if (/^(g|gram|grams)$/i.test(u)) grams = value;
                else if (/^(kg|kilogram|kilograms)$/i.test(u)) grams = value * 1000;
                else if (/^(oz|ounce|ounces)$/i.test(u)) grams = value / 0.035274;
                else if (/^(lb|lbs|pound|pounds)$/i.test(u)) grams = value / 0.00220462;

                if (targetSystem === 'imperial') {
                    // prefer oz, but if > 16 oz, use lb
                    const oz = grams * 0.035274;
                    if (oz >= 16) return { value: oz / 16, unit: 'lb' };
                    return { value: oz, unit: 'oz' };
                } else {
                    // metric: use g or kg
                    if (grams >= 1000) return { value: grams / 1000, unit: 'kg' };
                    return { value: grams, unit: 'g' };
                }
            }

            // detect volume units
            if (/^(ml|milliliter|l|liter|litre|tsp|teaspoon|tbsp|tablespoon|cup|cups|fl oz|floz|oz)$/i.test(u)) {
                // convert any to ml
                let ml = null;
                if (/^(ml|milliliter)$/i.test(u)) ml = value;
                else if (/^(l|liter|litre)$/i.test(u)) ml = value * 1000;
                else if (/^(tsp|teaspoon)$/i.test(u)) ml = value * 4.92892;
                else if (/^(tbsp|tablespoon)$/i.test(u)) ml = value * 14.7868;
                else if (/^(cup|cups)$/i.test(u)) ml = value * 240;
                else if (/^(fl oz|floz|oz)$/i.test(u)) ml = value / 0.033814;

                if (targetSystem === 'imperial') {
                    const floz = ml * 0.033814;
                    if (floz >= 8) return { value: floz / 8, unit: 'cup' }; // use cups for larger volumes
                    return { value: floz, unit: 'fl oz' };
                } else {
                    if (ml >= 1000) return { value: ml / 1000, unit: 'L' };
                    return { value: ml, unit: 'ml' };
                }
            }

            // default: no conversion
            return { value, unit };
        }

        function scaleIngredient(ingredient, factor, targetUnits) {
            // Try to detect a leading quantity (mixed number, fraction, or decimal/integer, possibly attached to unit like '400g')
            const trimmed = ingredient.trim();
            // Mixed number like '1 1/2'
            const mixedMatch = trimmed.match(/^(\d+\s+\d+\/\d+)(?:\s+|\b)(.*)/);
            if (mixedMatch) {
                const val = parseMixedNumber(mixedMatch[1]);
                const scaled = val * factor;
                return `${formatNumber(scaled)} ${mixedMatch[2]}`.trim();
            }
            // fraction like '3/4'
            const fracMatch = trimmed.match(/^(\d+\/\d+)(?:\s+|\b)(.*)/);
            if (fracMatch) {
                const val = parseMixedNumber(fracMatch[1]);
                const scaled = val * factor;
                return `${formatNumber(scaled)} ${fracMatch[2]}`.trim();
            }
            // number with optional unit attached (e.g., '400g' or '2kg') at start
            const numUnitMatch = trimmed.match(/^([0-9]+(?:\.[0-9]+)?)([a-zA-Z%¬∞¬µ]*)\b(?:\s*)(.*)$/);
            if (numUnitMatch) {
                const val = parseFloat(numUnitMatch[1]);
                if (!isNaN(val)) {
                    const unit = numUnitMatch[2] || '';
                    const rest = numUnitMatch[3] || '';
                    const scaled = val * factor;
                    // try unit conversion if requested
                    if (targetUnits) {
                        const converted = convertUnit(scaled, unit, targetUnits);
                        return `${formatNumber(converted.value)}${converted.unit ? ' ' + converted.unit : ''} ${rest}`.trim();
                    }
                    return `${formatNumber(scaled)}${unit} ${rest}`.trim();
                }
            }
            // number with space then unit (e.g., '2 cups')
            const numSpaceMatch = trimmed.match(/^([0-9]+(?:\.[0-9]+)?)(?:\s+)([^\s].*)$/);
            if (numSpaceMatch) {
                const val = parseFloat(numSpaceMatch[1]);
                if (!isNaN(val)) {
                    const rest = numSpaceMatch[2];
                    const scaled = val * factor;
                    // if rest starts with a unit token, attempt convert
                    const unitTokenMatch = rest.match(/^([a-zA-Z%¬∞¬µ]+)\b(.*)$/);
                    if (unitTokenMatch && targetUnits) {
                        const unit = unitTokenMatch[1];
                        const tail = unitTokenMatch[2] ? unitTokenMatch[2].trim() : '';
                        const converted = convertUnit(scaled, unit, targetUnits);
                        return `${formatNumber(converted.value)} ${converted.unit ? converted.unit : unit} ${tail}`.trim();
                    }
                    return `${formatNumber(scaled)} ${rest}`.trim();
                }
            }
            // fallback: no leading number, return unchanged
            return ingredient;
        }

        function openModal(recipeId) {
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            const origServings = Number(recipe.servings) || 1;
            // load persisted servings for this recipe if present
            const savedKey = `recipe_servings_${recipe.id}`;
            const saved = Number(localStorage.getItem(savedKey));
            const initialServings = saved && saved > 0 ? saved : origServings;
            const modalBody = document.getElementById('modalBody');
            // build ingredients list with data-original attributes so we can rescale
            const ingredientsHtml = recipe.ingredients.map(ing => `<li data-orig="${ing.replace(/"/g, '\"')}">${ing}</li>`).join('');
            modalBody.innerHTML = `
                <h2>${recipe.title}</h2>
                <div class="modal-section">
                    <h3>Time & Servings</h3>
                    <p><strong>Time:</strong> ${recipe.time}</p>
                    <p><strong>Difficulty:</strong> ${recipe.difficulty}</p>
                    <label style="display:inline-flex;align-items:center;gap:.5rem;margin-top:.5rem">Servings:
                        <input id="servingsInput" type="number" min="1" value="${initialServings}" style="width:64px;padding:.25rem .4rem;border:1px solid var(--border);border-radius:6px;margin-left:.5rem">
                    </label>
                </div>
                <div style="display:flex;gap:1rem;align-items:center;justify-content:space-between;margin-top:.5rem">
                    <div>
                        <label style="font-size:.95rem;color:var(--muted);">Units:</label>
                        <select id="unitsSelect" style="margin-left:.5rem;padding:.25rem .5rem;border-radius:6px;border:1px solid var(--border)">
                            <option value="metric">Metric</option>
                            <option value="imperial">Imperial</option>
                        </select>
                    </div>
                    <div>
                        <button id="resetServingsBtn" type="button" style="background:transparent;border:1px solid var(--border);padding:.4rem .6rem;border-radius:8px;cursor:pointer">Reset</button>
                    </div>
                </div>
                <div class="modal-section">
                    <h3>Ingredients</h3>
                    <ul id="ingredientsList">${ingredientsHtml}</ul>
                </div>
                <div class="modal-section">
                    <h3>Instructions</h3>
                    <ol>${recipe.instructions.map(inst => `<li>${inst}</li>`).join('')}</ol>
                </div>
            `;

            // attach input listener to rescale ingredients
            const servingsInput = document.getElementById('servingsInput');
            // units select initial value
            const unitsSelect = document.getElementById('unitsSelect');
            unitsSelect.value = unitsPref;
            unitsSelect.addEventListener('change', function () {
                unitsPref = this.value;
                try { localStorage.setItem('units_pref', unitsPref); } catch (e) { }
                rescale();
            });

            function rescale() {
                const desired = Number(servingsInput.value) || origServings;
                const factor = desired / origServings;
                const list = document.getElementById('ingredientsList');
                Array.from(list.children).forEach(li => {
                    const orig = li.getAttribute('data-orig');
                    // pass targetUnits based on unitsPref
                    li.textContent = scaleIngredient(orig, factor, unitsPref === 'metric' ? 'metric' : 'imperial');
                });
                // persist chosen servings
                try { localStorage.setItem(savedKey, String(desired)); } catch (e) { /* ignore storage errors */ }
            }
            servingsInput.addEventListener('input', rescale);
            // reset button
            const resetBtn = document.getElementById('resetServingsBtn');
            resetBtn.addEventListener('click', function () {
                servingsInput.value = origServings;
                try { localStorage.removeItem(savedKey); } catch (e) { }
                rescale();
            });

            // initial scale (in case origServings is not 1) and initial conversion
            rescale();

            document.getElementById('recipeModal').classList.add('active');
        }

        function closeModal() { document.getElementById('recipeModal').classList.remove('active'); }

        document.getElementById('searchInput').addEventListener('keypress', function (e) { if (e.key === 'Enter') searchRecipes(); });
        document.getElementById('recipeModal').addEventListener('click', function (e) { if (e.target === this) closeModal(); });

        // initial render
        renderRecipes(recipes);
    </script>
</body>

</html>